Функции использует FuzzyWuzzy, чтобы вычислить сходство текстов и названий документов.

Названия документов сравниваются по наибольшему схожему фрагменту.

Тексты документов проходят обработку (удаление ненужных символов и т.п.), разбиваются списки строк по разным delimiters. 

Из сравниваемой пары списков строк строк выбиратеся список с наименьшим числом элементов. 
Для каждой строки из короткого списка ищется наиболее похожая строка из длинного списка, вычисляется сходство между этими двумя строками. Сходство двух текстов считается как среднее значение по этим величинам. 


Скрипт find_sim_and_check_matched_and_shuffled_matched.py:

считает сходство названий/текстов пар документов из файла matches.csv,

name_ratio	text_ratio	id_reg	id_pub
99	73.22222222222223	92278	1201908020023
99	82.43333333333334	92303	1201907310018
98	75.75			89325	1201907250049
99	87.2439024390244	92291	1201907230010
84	96.22784810126582	91665	1201907160036
99	97.41176470588235	92281	1201907110019
99	81.0			92283	1201907100027
99	81.34285714285714	92275	1201907020036
96	90.6			89431	1201906260030
100	79.97619047619048	91473	1201907030054
100	98.13888888888889	89443	1201906210006
99	99.0			91673	1201906280030
99	99.4			91678	1201906280029
99	98.77358490566037	90372	1201907310008
99	61.83673469387755	89441	1201907310014
100	80.5			90580	1201907110016
100	66.8			90297	1201908020029
99	90.8			91365	1201908090018
96	91.25			90243	1201908090016
93	98.0			92697	1201908070004
100	95.1923076923077	90475	1201908070003
99	94.47368421052632	93594	1201908070002

считает сходство названий/текстов пар документов, полученных путем случайного перемешивания id publication и regulation в файле matches.csv

name_ratio	text_ratio	id_reg	id_pub
41	67.0			92278	1201907230043
44	64.1875			92303	1201907050003
41	86.0			89325	1201907230042
37	62.132075471698116	92291	1201906210006
43	83.75862068965517	91665	1201908070004
42	57.11764705882353	92281	1201908090033
39	54.0			92283	1201908080002
91	78.33333333333333	92275	1201907310018
38	81.82608695652173	89431	1201906030016
51	77.47619047619048	91473	1201905240059
45	79.15			89443	1201908080011
45	69.0			91673	1201908090010
50	75.4			91678	1201907310008
52	76.44827586206897	90372	1201907040001
35	59.333333333333336	89441	1201906210015
47	73.125			90580	1201906280029
40	70.1			90297	1201907310023
40	81.4			91365	1201907030054
39	78.14285714285714	90243	1201907110019
42	76.86363636363636	92697	1201907250046
40	70.7			90475	1201907230002
39	71.21951219512195	93594	1201907100027

Для полученной выборки мер сходства случайных пар из matches.csv считает 95% квантили для названий и текстов.
Эти квантили используются далее как порог для определения сходства. Для того, чтобы считать 2 документа схожими, нужно, чтобы меры схожести названий и текстов превышали соответствующие квантили:

min_name_ratio:  56.65 		min_text_ratio:  84.49873949579832

Полученный критерий проверяется на выборке matches.csv. 
Примерно половина пар из matches.csv оказалась "не схожей" согласно этому критерию:

name_ratio	text_ratio	id_reg	id_pub	is_same_document
99	73.22222222222223	92278	1201908020023	False
99	82.43333333333334	92303	1201907310018	False
98	75.75	89325	1201907250049	False
99	87.2439024390244	92291	1201907230010	True
84	96.22784810126582	91665	1201907160036	True
99	97.41176470588235	92281	1201907110019	True
99	81.0	92283	1201907100027	False
99	81.34285714285714	92275	1201907020036	False
96	90.6	89431	1201906260030	True
100	79.97619047619048	91473	1201907030054	False
100	98.13888888888889	89443	1201906210006	True
99	99.0	91673	1201906280030	True
99	99.4	91678	1201906280029	True
99	98.77358490566037	90372	1201907310008	True
99	61.83673469387755	89441	1201907310014	False
100	80.5	90580	1201907110016	False
100	66.8	90297	1201908020029	False
99	90.8	91365	1201908090018	True
96	91.25	90243	1201908090016	True
93	98.0	92697	1201908070004	True
100	95.1923076923077	90475	1201908070003	True
99	94.47368421052632	93594	1201908070002	True

Было решено в качестве критерия выбрать минимальное значение name_ratio из таблицы для сматченной выборки, уменьшенное на 20% (произвольно выбранное число):

name_ratio	text_ratio	id_reg	id_pub	is_same_document
99	73.22222222222223	92278	1201908020023	True
99	82.43333333333334	92303	1201907310018	True
98	75.75	89325	1201907250049	True
99	87.24390243902441	92291	1201907230010	True
84	96.2278481012658	91665	1201907160036	True
99	97.41176470588236	92281	1201907110019	True
99	81.0	92283	1201907100027	True
99	81.34285714285714	92275	1201907020036	True
96	90.6	89431	1201906260030	True
100	79.97619047619048	91473	1201907030054	True
100	98.13888888888887	89443	1201906210006	True
99	99.0	91673	1201906280030	True
99	99.4	91678	1201906280029	True
99	98.77358490566036	90372	1201907310008	True
99	61.836734693877546	89441	1201907310014	True
100	80.5	90580	1201907110016	True
100	66.8	90297	1201908020029	True
99	90.8	91365	1201908090018	True
96	91.25	90243	1201908090016	True
93	98.0	92697	1201908070004	True
100	95.19230769230771	90475	1201908070003	True
99	94.47368421052632	93594	1201908070002	True

Далее сравнение по текстам проводится только для тех пар, для которых name_ratio больше выбранного порога.
На выходе получена таблица пар с укаханными name_ratio и text_ratio.

Из нее можно будет выбрать те, для которых text_ratio больше какого-то значения, найденного по случайной выборке пар из всех файлов.



